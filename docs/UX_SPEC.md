# XBrowser UX 规格（参考 Zen 并做微调）

本文件描述 **XBrowser（Windows-only，Qt 6 + QML + WebView2）** 的用户体验与交互规格，用来指导实现与验收。

> 原则：**复刻“行为与体验”**，不复用 Zen 的实现代码与资源（避免许可证/资产/商标风险）。

## 0. 范围与里程碑

### 0.1 本规格覆盖

- 主窗口布局与基础交互（地址栏、导航、标签、工作区、侧边栏）
- 关键输入方式（鼠标/触摸板/键盘快捷键）
- 下载、权限请求、扩展（安装/启用禁用/工具栏与 popup 的交互）
- 视觉与动效的“行为规则”（不限定最终美术稿，但给出推荐 token 与时序）

### 0.2 非目标（暂不在本规格强制）

- 账号同步、跨设备同步
- 内置广告拦截（优先扩展路线）
- 完整对标 Chrome 的每一项细节（以“好用、稳定、可维护”为先）

### 0.3 交付分级

- **M0（可跑骨架）**：单窗口、垂直标签栏、多标签、地址栏导航、基础快捷键。
- **M1（可日用）**：会话恢复、下载面板、权限提示、扩展（Load unpacked + 列表 + 启用/禁用）。
- **M2（Zen 化）**：工作区完善、侧边栏/网页面板、扩展工具栏与 popup、主题与动效。

## 1. 术语

- **Tab（标签页）**：一个网页内容实例。
- **Pinned Tab（固定标签）**：固定在标签栏顶部的标签（优先显示图标，减少误关闭）。
- **Workspace（工作区）**：一组 Tab 的集合 + 工作区级 UI 状态（例如侧边栏开关）。
- **Panel（面板）**：侧边栏内的功能页（书签/历史/下载/扩展）或网页面板（Web Panel）。
- **Omnibox（地址栏）**：既可输入 URL，也可输入搜索关键词的输入框。

## 2. 全局 UX 原则

- **可见价值优先**：垂直标签 + 工作区 + 侧边栏是“第一眼就能感知”的差异化。
- **键盘优先但不强迫**：所有高频操作都有快捷键；鼠标路径同样直观。
- **非阻塞提示**：权限/下载等尽量使用“门挂式（doorhanger）”或轻量 toast，而非模态对话框。
- **状态可预期**：同一动作在不同状态下有一致结果（例如：关闭 tab、切换 workspace）。
- **少惊喜**：默认行为偏保守（比如关闭多个标签时二次确认可配置）。

## 3. 主窗口布局（信息架构）

### 3.1 布局区域

- 左侧：**垂直标签栏**（可折叠/悬浮展开）
- 顶部：**导航栏**（后退/前进/刷新、地址栏、扩展入口、下载入口、菜单）
- 中间：**内容区**（WebView2）
- 右侧（可选）：**侧边栏/面板**（默认关闭，可由工作区记忆）

### 3.2 推荐尺寸与 token（可主题化）

- 垂直标签栏宽度：
  - `CollapsedWidth = 56dp`
  - `ExpandedWidth = 260dp`
- Tab 行高：`TabRowHeight = 36dp`（Pinned 可稍大：`40dp`）
- 圆角：`Radius = 10dp`（卡片/弹窗）
- 动效：
  - 快速：`120ms`（hover、淡入淡出）
  - 标准：`180ms`（面板展开、列表切换）
  - 慢速：`240ms`（布局重排、大范围过渡）

## 4. 垂直标签栏（核心）

### 4.1 展开/折叠规则

- 默认支持两种模式（设置项）：
  1) **固定展开**：始终 `ExpandedWidth`
  2) **悬浮展开**（推荐默认）：平时 `CollapsedWidth`；鼠标悬停标签栏区域后展开
- 悬浮展开时序（建议）：
  - 进入标签栏区域后 `120ms` 展开（避免误触）
  - 离开标签栏区域后 `300ms` 折叠（给用户容错）
- 折叠状态：
  - 仅显示 favicon / loading 状态 / 音频状态点
  - title 以 tooltip 形式呈现（hover 300ms 出现）

### 4.2 Tab 行元素（展开态）

每个 Tab 行从左到右：

- favicon（或 loading spinner）
- title（单行，超出省略）
- 状态图标（按需出现）：音频/静音、需要注意（attention）、崩溃
- close 按钮（仅在 hover 或 active 时出现）

### 4.3 Tab 状态与视觉规则

- Active：高亮背景 + 左侧强调条（workspace 色或主题强调色）
- Hover：轻微背景抬升/变亮
- Loading：
  - favicon 位显示 spinner
  - 顶部导航栏可显示细进度条
- Attention（例如页面请求通知、播放音频、下载完成可选）：
  - tab 行显示小点或铃铛图标
- Audio：
  - 播放音频：显示喇叭
  - 静音：显示静音图标
  - 点击音频图标切换“仅该 tab 静音/取消静音”

### 4.4 Tab 基本交互

- 单击：激活该 Tab
- 中键单击：关闭该 Tab
- 双击空白处：新建 Tab（可配置）
- 拖拽排序：
  - 拖动 tab 行上下移动排序
  - 拖动到列表顶部/底部触发自动滚动
  - 释放时显示明确插入指示器（线/占位块）
- 拖拽到工作区切换器（见 6）：把 Tab 移动到目标 Workspace
- 关闭按钮：
  - hover/active 显示
  - 点击关闭；若有“未保存表单”由网页自行提示（浏览器不二次阻断）

### 4.5 Tab 右键菜单（MVP 版）

- 新建标签
- 重新加载 / 强制重新加载（Shift+Reload）
- 复制链接
- 复制标题
- 固定/取消固定
- 静音/取消静音
- 复制标签（Duplicate）
- 关闭
- 关闭其他
- 关闭右侧（可选）
- 移动到工作区 → 子菜单列出 workspace

## 5. 标签管理（全局）

### 5.1 新建 Tab 行为

入口：

- Ctrl+T
- 标签栏顶部“+”按钮
- 地址栏输入并按 Enter（若当前 tab 为新标签页，可复用；否则按设置决定是复用还是新开）

默认：在当前 Tab 的右侧新建并激活。

### 5.2 关闭行为

- Ctrl+W：关闭当前 Tab
- Ctrl+Shift+T：恢复最近关闭的 Tab（按 workspace 维度优先恢复；不可恢复则全局）
- 关闭最后一个 Tab：
  - 默认：保留窗口并显示新标签页（不直接退出）
  - 可配置：关闭窗口

### 5.3 多选（M2）

- Ctrl/Shift 多选 tab
- 批量关闭、批量移动到 workspace、批量固定

## 6. 工作区（Workspace）

### 6.1 工作区切换器位置

推荐放在垂直标签栏顶部（靠近视线、符合“左侧导航”心智）：

- 当前 workspace 名称/图标
- 点击展开 workspace 列表
- “+” 创建 workspace

### 6.2 工作区行为（默认）

- 每个 workspace 有自己的 tab 列表与“最后活动 tab”
- 切换 workspace：
  - 立即切换 tab 列表
  - 自动激活该 workspace 的“最后活动 tab”（若为空则打开新标签页）
- workspace 状态记忆（M1）：
  - 侧边栏开关（开/关）
  - 侧边栏当前 panel

> 待确认（建议默认）：Pinned Tabs 是 **每 workspace 独立**；后续可提供“全局固定”开关。

### 6.3 工作区管理

- 创建：输入名称 + 可选颜色/图标
- 重命名
- 删除：
  - 若 workspace 内有 tab，弹出确认（选项：关闭所有 / 移动到默认 workspace）
- 排序：拖拽 workspace 项调整顺序

### 6.4 动效建议

- 切换 workspace：tab 列表做 150~180ms 的淡入/滑动过渡（轻量即可，避免眩晕）

## 7. 侧边栏与面板（Sidebar / Panels）

### 7.1 侧边栏开关

入口：

- 工具栏按钮（建议常驻）
- 快捷键：Ctrl+B（传统书签）容易冲突；建议提供可配置快捷键（M1）

行为：

- 侧边栏展开时占用内容区宽度（不覆盖网页），避免空域叠层问题
- 侧边栏可调整宽度（拖拽分隔条）

### 7.2 面板类型

- 原生面板：书签/历史/下载/扩展
- 网网页面板（Web Panel，M2）：一个固定站点以侧边栏 WebView 显示（类似 Zen 的网页侧栏）
  - 网网页面板默认与主 tab 独立导航历史
  - 可一键“在主 tab 打开当前页面”

## 8. 地址栏（Omnibox）

### 8.1 聚焦与编辑规则

- Ctrl+L / Alt+D：聚焦地址栏并全选
- 单击地址栏：
  - 若当前未选中：默认全选（可配置为光标定位）
- Esc：
  - 若下拉建议打开：关闭建议
  - 否则：恢复到当前页面 URL（撤销编辑）

### 8.2 输入解析

- 输入看起来像 URL（含 scheme 或包含 `.` 且无空格等启发式）：按 URL 导航
- 否则：按默认搜索引擎搜索（显示搜索建议为 M2）

### 8.3 下拉建议（M1 起）

来源优先级（建议）：

1) 书签匹配
2) 历史匹配
3) 打开的 tab 匹配（用于快速切换）
4) 搜索建议（M2，可开关）

键盘：

- ↑/↓ 选择项
- Enter 打开
- Ctrl+Enter：补全 `www.` 与 `.com`（可配置）

### 8.4 站点信息与权限入口

- 地址栏左侧：锁/警告图标
  - 点击打开站点信息面板（证书、权限开关、清理站点数据入口）

## 9. 页面/链接交互（右键菜单）

由于 WebView 原生层级限制，菜单实现建议用 **顶层无边框窗口**（定位到鼠标处），保证可覆盖网页区域。

### 9.1 页面空白处右键（MVP）

- 后退 / 前进
- 刷新
- 另存为（可后置）
- 打印（可后置）
- 查看页面源代码（可后置）
- 检查（DevTools，开发版开关）

### 9.2 链接右键（MVP）

- 在新标签页打开
- 在新工作区打开（M2，可选）
- 复制链接地址

## 10. 下载（Downloads）

### 10.1 触发与展示

- 下载开始：工具栏下载图标出现进度/数量 badge
- 下载完成：非阻塞 toast（可点击“打开文件夹”）
- 点击下载图标：打开下载面板（侧边栏 panel 或弹出面板二选一；建议侧边栏 panel，避免空域）

### 10.2 下载项交互（M1）

- 进度条、暂停/继续、取消
- 完成后：打开文件 / 打开所在文件夹
- 失败：显示原因（尽量提供可读信息）与重试

## 11. 权限请求（Permissions）

### 11.1 交互形态

- 优先 doorhanger（靠近地址栏右侧的轻量提示）
- 不建议使用模态对话框（除非系统级权限）

### 11.2 决策选项（M1）

- 允许一次
- 总是允许
- 阻止

### 11.3 复查入口

- 站点信息面板中可随时修改权限
- 设置页提供“站点权限管理”

## 12. 扩展（Extensions）

### 12.1 MVP 能力（必须）

- “加载解压扩展（Load unpacked）”
- 扩展列表（名称/版本/描述/权限摘要）
- 启用/禁用开关

### 12.2 扩展入口

- 工具栏提供“扩展”按钮：
  - 点击打开扩展管理弹窗/面板（列表 + Load unpacked）
  - 右侧提供“固定到工具栏”的开关（M2）

### 12.3 扩展工具栏（M2）

- 显示 pinned 扩展图标（超出进入 overflow）
- 点击扩展图标：
  - 若有 `action.default_popup`：打开 popup（顶层无边框窗口承载一个 WebView，导航到 `chrome-extension://...`）
  - 若无 popup：触发扩展 action（如果可用）或打开扩展详情页

## 13. 设置（Settings）

建议原生 QML 页面（`xbrowser://settings` 概念页，不必须真用自定义 scheme）。

必须项（M1）：

- 启动：恢复上次会话 / 打开新标签页
- 主页与新标签页
- 下载目录
- 默认搜索引擎
- 侧边栏开关与位置
- 隐私：清理数据（历史/缓存/cookies）
- 扩展管理入口

## 14. 键盘快捷键（MVP 建议集）

- Ctrl+L / Alt+D：聚焦地址栏
- Ctrl+T：新建标签
- Ctrl+W：关闭标签
- Ctrl+Shift+T：恢复关闭标签
- Ctrl+Tab / Ctrl+Shift+Tab：切换下/上一个标签
- Ctrl+R：刷新
- Alt+← / Alt+→：后退/前进
- Ctrl+F：页内查找（可后置）
- Ctrl+Shift+I：DevTools（开发版开关）

## 15. 可访问性（A11y）与输入法

- 所有可点击控件有键盘可达焦点与可读 label
- 关键操作不依赖 hover（触摸板/触屏可用）
- 中文输入法：地址栏与设置等原生输入组件必须保证 IME 光标位置正确（优先用 Qt 原生输入控件）

## 16. 待确认（请你选 Top 3）

为了更像 Zen 且更符合你的微调方向，请确定你最想优先做的 Top 3：

1) 垂直标签栏：自动展开/固定展开/多选/预览/分组？
2) 工作区：Pinned 是否全局？切换是否保留后台加载？
3) 侧边栏：原生面板为主还是网页面板为主？
4) 分屏：左右分屏还是网格？与工作区如何交互？
5) 命令面板：是否要作为核心入口（Ctrl+K）？

